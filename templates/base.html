{% load static %}

<!DOCTYPE html>
<html class="h-100">

<head>
    <title>Juicy Recipes</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="~/lib/Font-Awesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="~/lib/Font-Awesome/css/regular.min.css">
    <link rel="stylesheet" href="~/lib/Font-Awesome/css/solid.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body class="d-flex flex-column h-100 main-bg">

    <!-- Navigation -->
      <nav id="main-nav" class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'home' %}">
                <img src="https://res.cloudinary.com/dofxnvsmw/image/upload/v1654371284/Juicy_Recipes_500_200px_500_100px_450_100px_350_100px_250_100px_aahtq0.png">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText"
                aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'my_favorites' %}">My Favorites</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'home' %}">Forum</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'categories' %}">Categories</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'search' %}">Search</a>
                    </li>

                    </ul>

                    <ul id="login-bar" class="navbar-nav me-auto mb-2 mb-lg-0 nav navbar-nav">
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'account_logout' %}">Logout</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'account_signup' %}">Register</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'account_login' %}">Login</a>
                    </li>
                    {% endif %}
                </ul>
           
            </div>
        </div>
    </nav>
<!-- <img src="https://res.cloudinary.com/dofxnvsmw/image/upload/v1653851497/hero_pucrqd.png"> -->
    <main class="flex-shrink-0 main-bg">
        {% block content %}
        <!-- Content Goes here -->
        {% endblock content %}
    </main>
    
    <!-- Footer -->
    <footer class="footer mt-auto py-3 dark-bg">
        <p class="text-center">Made by Laura Zvirbule</p>
        <p class="text-center">Follow us: <i class="fab fa-facebook-square ms-3"></i>
            <i class="fab fa-twitter-square ms-3"></i>
            <i class="fab fa-instagram-square ms-3"></i>
            <i class="fab fa-youtube-square ms-3"></i></p>
    </footer>


    <script>



        setTimeout(function () {
            let messages = document.getElementById('msg');
            let alert = new bootstrap.Alert(messages);
            alert.close();
        }, 2500);

    // SEARCH AREA API 

    function searchBtnClicked() {
    let searchBtn = document.getElementById('search-btn')
    searchBtn.addEventListener("click", ()=> {

            sendAPIcall();
            dipsplayResults(searchData)
        })
}








async function sendAPIcall() {

        let searchvalue = document.getElementById('text-value').value

        let APP_ID = "2f1133a1"
        let API_KEY = "63872c307c1ea5bea9706e007963df6f"
        let response = await fetch(`https://api.edamam.com/search?app_id=${APP_ID}&app_key=${API_KEY}&q=${searchvalue}`);
        console.log(response)
        let searchData = await response.json()
        console.log(searchData);
        console.log(`${searchData.hits[0].recipe.label}`)
        dipsplayResults(searchData)
        console.log(`Search value is: ${searchvalue}`)
        console.log(searchData.hits)
    }




    function dipsplayResults(searchData) {
        searchData.hits.map(recipe=> {
        var recipeCard = document.createElement('div');
        recipeCard.classList.add('col-md-4')
        recipeCard.innerHTML = 
              `  <a href="${recipe.recipe.url}" target="_blank">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="image-container">
                                <img class="card-image"
                                src="${recipe.recipe.image}">
                            </div>
                            <h2 class="card-title">${recipe.recipe.label}</h2>
                            <hr />
                            <p class="card-bottom">Created by: ${recipe.recipe.source}     <span> Cal: ${recipe.recipe.calories.toFixed(0)}</span></p>

                        </div>
                    </div>
                </div>
                </a>
    `
  document.getElementsByClassName('search-results')[0].appendChild(recipeCard);
})
 }

  // CATEGORIES
  


async function getHealthyCall() {
    
    let searchvalue = "healthy"
    let APP_ID = "2f1133a1"
    let API_KEY = "63872c307c1ea5bea9706e007963df6f"
    let response = await fetch(`https://api.edamam.com/search?app_id=${APP_ID}&app_key=${API_KEY}&q=${searchvalue}`);
    console.log(response)
    let searchHealthy = await response.json()
    console.log(searchHealthy);
    console.log(`${searchHealthy.hits[0].recipe.label}`)
    dipsplayHealthyResults(searchHealthy)
    console.log(`Search value is: ${searchvalue}`)
    console.log(searchHealthy.hits)
}

function dipsplayCategoryResults(searchCategory, categorie) {
        searchCategory.hits.map(recipe=> {
        var recipeCard = document.createElement('div');
        recipeCard.classList.add('col-md-4')
        recipeCard.innerHTML = 
              `  <a href="${recipe.recipe.url}" target="_blank">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="image-container">
                                <img class="card-image"
                                src="${recipe.recipe.image}">
                            </div>
                            <h2 class="card-title">${recipe.recipe.label}</h2>
                            <hr />
                            <p class="card-bottom">Created by: ${recipe.recipe.source}     <span> Cal: ${recipe.recipe.calories.toFixed(0)}</span></p>

                        </div>
                    </div>
                </div>
                </a>
    `
    // console.log("testy")
    // console.log(searchCategory);
    // if (searchCategory == "healthy") {
    //     document.getElementsByClassName('healthy-results')[0].appendChild(recipeCard);
    // } else if (searchCategory == "vegetarian") {
    //     document.getElementsByClassName('vegetarian-results')[0].appendChild(recipeCard);
    // } else  {
    //     document.getElementsByClassName('deserts-results')[0].appendChild(recipeCard);
    // }
    document.getElementsByClassName(`${categorie}-results`)[0].appendChild(recipeCard);

})
}

// VEGETARIAN

// async function getVegetarianCall() {
    
//     let searchvalue = "vegetarian"
   
//     let response = await fetch(`https://api.edamam.com/search?app_id=${APP_ID}&app_key=${API_KEY}&q=${searchvalue}`);
//     console.log(response)
//     let searchHealthy = await response.json()
//     console.log(searchHealthy);
//     console.log(`${searchHealthy.hits[0].recipe.label}`)
//     dipsplayHealthyResults(searchHealthy)
//     console.log(`Search value is: ${searchvalue}`)
//     console.log(searchHealthy.hits)
// }

// function dipsplayVegetarianResults(searchHealthy) {
//         searchHealthy.hits.map(recipe=> {
//         var recipeCard = document.createElement('div');
//         recipeCard.classList.add('col-md-4')
//         recipeCard.innerHTML = 
//               `  <a href="${recipe.recipe.url}" target="_blank">
//                     <div class="card mb-4">
//                         <div class="card-body">
//                             <div class="image-container">
//                                 <img class="card-image"
//                                 src="${recipe.recipe.image}">
//                             </div>
//                             <h2 class="card-title">${recipe.recipe.label}</h2>
//                             <hr />
//                             <p class="card-bottom">Created by: ${recipe.recipe.source}     <span> Cal: ${recipe.recipe.calories.toFixed(0)}</span></p>

//                         </div>
//                     </div>
//                 </div>
//                 </a>
//     `
//   document.getElementsByClassName('vegetarian-results')[0].appendChild(recipeCard);
// })
// }

window.onload = function() {
    getMultipleAPIcalls()
//   if (window.location.href.indexOf('search.html') > -1) {
//     searchBtnClicked()
//   } else {
//     getHealthyCall();
//         dipsplayHealthyResults(searchHealthy)
//         dipsplayVegetarianResults(searchHealthy)
//   }
}



// MULTIPLE API CALLS FOR CATEGORIES:

async function getMultipleAPIcalls(recipeCard) {
    const categories = ["healthy", "vegetarian", "deserts", "light", "grilled", "meat", "fish", "kids"];
    const responses = await Promise.all(
	categories.map(async categorie => {
        let APP_ID = "2f1133a1"
        let API_KEY = "63872c307c1ea5bea9706e007963df6f"
        let response = await fetch(
            `https://api.edamam.com/search?app_id=${APP_ID}&app_key=${API_KEY}&q=${categorie}`
           
        );
        // console.log(response)
        let searchCategory = await response.json()
        console.log(searchCategory);
        dipsplayCategoryResults(searchCategory, categorie)
        // console.log(searchCategory.hits)
        
	})
);
}



</script>
</body>

</html>